var Myspace = Myspace || {};
(function (a) {
    function f(a) {
        var c = b,
            d = a.$root[0],
            e = 0,
            f = c.length,
            g;
        b = [];
        for (; e < f; e++) g = c[e], g.$root[0] != d && b.push(g)
    }
    function g() {
        var a, c = b.length,
            d;
        if (c) {
            a = b[c - 1], d = a.$root;
            if (d.hasClass("lightbox") && d.hasClass("donotescape")) return;
            a.hide(), a.options.closeAll && h()
        }
        e = !1
    }
    function h(a) {
        var c = a && a.jquery ? a[0] : a,
            d = 0,
            e = b.length,
            f;
        for (; d < e; d++) f = b[d], f.$root[0] != c && (f.hide(), e--, d--)
    }
    var b = [],
        c = a("#dialogCover"),
        d = a("#lightboxCover"),
        e;
    comm.listen("page.esc", function () {
        e ? e = !1 : g()
    }, !0), comm.listen("upload.browseOpen", function () {
        e = !0
    }, !0), comm.listen("upload.browseClose", function () {
        e = !1
    }, !0), d.find(".close").click(g), d.find(".info").click(g), Myspace.Dialog = function (e, g) {
        function o(a) {
            if (m) return;
            g.closeAll && h(j), i("showing", j), k || l.click(p), l.removeClass("hide"), g.centerDialog && r(), j.addClass("open").removeClass("close"), a || j.find("input[type=text], input[type=email], input[type=password], textarea").first().focus(), m = !0, b.push(t)
        }
        function p() {
            if (m == 0) return;
            k ? !g.closeAll && b.length > 1 || l.addClass("hide") : l.addClass("hide"), j.addClass("close"), k ? j.removeClass("open").removeClass("close") : setTimeout(function () {
                j.removeClass("open").removeClass("close")
            }, 500), m = !1, k || l.off("click", p), f(t), i("hiding", j)
        }
        function q() {
            m ? p() : o()
        }
        function r() {
            var b = j.outerWidth() / 2,
                c = j.outerHeight() / 2,
                d;
            d || (d = a("#global").outerHeight() + a("#links").outerHeight() || 60), c += d / 2, j.css({
                "margin-left": "-" + b + "px",
                "margin-top": "-" + c + "px"
            })
        }
        function s() {
            return !m
        }
        var j = a(e),
            k = j.hasClass("lightbox"),
            l = k ? d : c,
            m = j.hasClass("open"),
            n = {
                centerDialog: !0,
                closeAll: !0
            };
        g = a.extend({}, n, g), comm.listen("spaceway.page.loading", h, !0), j.find(".close").click(p);
        var t = {
            show: o,
            hide: p,
            toggle: q,
            center: r,
            isClosed: s,
            $root: j,
            options: g
        };
        return m && b.push(t), t
    };
    var i = comm.own("dialog", {
        closeAll: h,
        isOpen: function (a) {
            typeof a == "function" && a(b.length)
        }
    }).broadcast,
        j = {
            html: "",
            close: !0,
            buttons: [{
                text: "OK",
                classes: "primary",
                click: function () {},
                setFocus: !0
            }]
        };
    Myspace.genericDialog = function (b) {
        var c = b.id || "genericDialog",
            d = a('<article id="' + c + '" class="dialog"></article>').appendTo("body"),
            e;
        b = a.extend({}, j, b), d.addClass(b.classes), b.close && a('<i class="close x_14">Close</i>').appendTo(d), b.html && a(b.html).appendTo(d);
        if (b.buttons && b.buttons.length) {
            var f = a("<footer>").appendTo(d),
                g = 0,
                h = b.buttons.length,
                i;
            for (; g < h; g++) {
                i = b.buttons[g];
                var k = a("<button>").appendTo(f).addClass(i.classes).text(i.text);
                k.click(function (b) {
                    return function (c) {
                        if (a.isFunction(b.click) && b.click(c) === !1) return;
                        return l.hide(), !1
                    }
                }(i)), i.setFocus && (e = k)
            }
        }
        var l = Myspace.Dialog(d, b);
        return comm.listen("dialog.hiding", function (a) {
            a.attr("id") == c && setTimeout(function () {
                l.$root.remove()
            }, 500)
        }), l.show(), e && e.focus(), delete l.show, l
    }, Myspace.noticeBoard = function (a) {
        a.id = "noticeBoard";
        var b = Myspace.genericDialog(a);
        return b
    }, Myspace.successDialog = function (a, b) {
        b && (b = "<h4>" + b + "</h4>");
        var c = Myspace.genericDialog({
            html: "<section>" + (b || "") + "<p>" + a + "</p></section>",
            close: !1,
            buttons: null,
            id: "successDialog"
        });
        setTimeout(function () {
            c.hide()
        }, 4e3)
    }
})(jQuery),
function (a) {
    function i(h) {
        b = a('<article id="confirmDialog" class="dialog"></dialog><p></p><div class="actions"><button class="no"></button><button class="yes primary"></button></div></article>'), c = b.children("p"), d = b.children(".actions"), e = d.children(".no"), f = d.children(".yes"), a("body").append(b), g = new Myspace.Dialog(b, h)
    }
    var b, c, d, e, f, g = null,
        h = {
            text: "Are you sure?",
            no: {
                text: "No thanks.",
                onClick: function () {}
            },
            yes: {
                text: "Yes please.",
                onClick: function () {}
            }
        };
    Myspace.Error = function (b) {
        var c = {
            text: "Oops, something went wrong and we were unable to complete your request.  Do you want to try again?",
            no: {
                text: "No"
            },
            yes: {
                text: "Retry"
            }
        }, d = a.extend(!0, {}, c, b);
        Myspace.Confirm(d)
    }, Myspace.Confirm = function (b) {
        function d() {
            k(), g.show(), f.focus()
        }
        function j() {
            g.hide()
        }
        function k() {
            c.html(b.text), e.toggleClass("hide", b.no === !1).text(b.no.text || "").unbind("click").click(function () {
                return b.no.onClick(), j(), !1
            }), f.toggleClass("hide", b.yes === !1).text(b.yes.text || "").unbind("click").click(function () {
                return b.yes.onClick(), j(), !1
            })
        }
        g || i(b), b = a.extend(!0, {}, h, b), b.beforeShow && b.beforeShow(g), d()
    }
}(jQuery);